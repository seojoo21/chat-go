<!DOCTYPE html>
<html>
<head>
    <title>Chat Client</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var conn;

            function init() {
                conn = new WebSocket("ws://localhost:8080/ws");

                conn.onopen = function(e) {
                    console.log("Connection established!");
                };

                /*conn.onmessage = function(e) {
                    var messages = document.getElementById('messages');
                    messages.innerHTML += '<li>' + e.data + '</li>';
                };*/

                conn.onmessage = function(e) {
                    var messages = document.getElementById('messages');
                    var message = JSON.parse(e.data);
                    messages.innerHTML += '<li><strong>' + message.username + '</strong>: ' + message.message + '</li>';
                };

                conn.onerror = function(e) {
                    console.log("Connection failed!");
                };
            }

            document.getElementById('messageForm').addEventListener('submit', function(e) {
                e.preventDefault();
                var message = {
                    email: "example@example.com", // Static or dynamic email
                    username: "User", // Static or dynamic username
                    message: document.getElementById('messageText').value
                };
                conn.send(JSON.stringify(message));
                document.getElementById('messageText').value = '';
            });

            init();
        });
    </script>
</head>
<body>
    <ul id="messages"></ul>
    <form id="messageForm">
        <input type="text" id="messageText" autocomplete="off" /><button>Send</button>
    </form>
</body>
</html>
